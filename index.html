<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>🧩 Puzzle : Niveau 1 🧠</title>
  <link rel="stylesheet" href="Puzzle/Files/style.css" />
</head>
<body>
  <div class="container">
    <h1><span class="blue">🧩</span> Puzzle : Niveau 1 <span class="red">🧩</span></h1>

    <div class="start-screen">
      <input type="text" id="playerName" placeholder="Entrez votre nom" />
      <button onclick="startGame()">Commencer</button>
    </div>

    <div class="game-info hidden">
      <div class="top-bar">
        <div id="score">Score : 0</div>
        <div id="timer">🕒 0:00</div>
        <div id="moves">Coups : 0</div>
      </div>

      <div id="puzzle" class="puzzle-grid"></div>

      <div class="controls">
        <button onclick="restartGame()">🔄 Rejouer</button>
        <div id="gameTimer">🕒 0:00</div>
        <button id="nextLevelBtn" onclick="goToLevel2()" disabled>➡️ Niveau 2</button>
      </div>
    </div>

    <div class="victory-message hidden" id="victoryMessage">
      🎉 Bravo <span id="winnerName"></span> ! Puzzle terminé ! 🎉
    </div>

    <div class="pub">
      <img src="Puzzle/Files/PUB.png" alt="Publicité" />
    </div>
  </div>

  <!-- Sons -->
  <audio id="clickSound" src="Puzzle/Files/click.mp3"></audio>
  <audio id="swapSound" src="Puzzle/Files/swap.mp3"></audio>
  <audio id="winSound" src="Puzzle/Files/win.mp3"></audio>

  <script>
    const PUZZLE_SIZE = 3;
    let score = 0;
    let moves = 0;
    let timer = 0;
    let interval;
    let player = '';
    let firstPiece = null;
    let puzzle = [];
    let solved = [];

    function startGame() {
      player = document.getElementById("playerName").value.trim();
      if (!player) return alert("Entrez votre nom !");
      document.querySelector(".start-screen").classList.add("hidden");
      document.querySelector(".game-info").classList.remove("hidden");
      document.getElementById("winnerName").textContent = player;
      initPuzzle();
      interval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
      timer++;
      const min = Math.floor(timer / 60);
      const sec = timer % 60;
      document.getElementById("gameTimer").textContent = `🕒 ${min}:${sec.toString().padStart(2, '0')}`;
    }

    function initPuzzle() {
      const container = document.getElementById("puzzle");
      container.innerHTML = "";
      puzzle = [];
      solved = [];
      let indices = Array.from({ length: PUZZLE_SIZE * PUZZLE_SIZE }, (_, i) => i);
      do {
        indices = indices.sort(() => Math.random() - 0.5);
      } while (indices.some((val, i) => val === i));

      for (let i = 0; i < indices.length; i++) {
        const piece = document.createElement("div");
        piece.className = "piece";
        const idx = indices[i];
        const row = Math.floor(idx / PUZZLE_SIZE);
        const col = idx % PUZZLE_SIZE;
        piece.style.backgroundImage = "url('Puzzle/Files/cat.jpg')";
        piece.style.backgroundPosition = `${-col * 100}px ${-row * 100}px`;
        piece.dataset.index = i;
        piece.dataset.correct = idx;
        piece.addEventListener("click", () => handleClick(piece));
        container.appendChild(piece);
        puzzle.push(idx);
        solved.push(i);
      }

      score = 0;
      moves = 0;
      timer = 0;
      document.getElementById("score").textContent = "Score : 0";
      document.getElementById("moves").textContent = "Coups : 0";
      document.getElementById("gameTimer").textContent = "🕒 0:00";
      document.getElementById("nextLevelBtn").disabled = true;
    }

    function handleClick(piece) {
      document.getElementById("clickSound").play();
      if (!firstPiece) {
        firstPiece = piece;
        piece.classList.add("selected");
        return;
      }

      const secondPiece = piece;
      if (firstPiece === secondPiece) return;

      const idx1 = [...firstPiece.parentElement.children].indexOf(firstPiece);
      const idx2 = [...secondPiece.parentElement.children].indexOf(secondPiece);

      [puzzle[idx1], puzzle[idx2]] = [puzzle[idx2], puzzle[idx1]];

      [firstPiece.style.backgroundPosition, secondPiece.style.backgroundPosition] =
        [secondPiece.style.backgroundPosition, firstPiece.style.backgroundPosition];

      document.getElementById("swapSound").play();

      moves++;
      if (puzzle[idx1] === idx1 && puzzle[idx2] === idx2) {
        score += 2;
      } else {
        score = Math.max(0, score - 1);
      }

      document.getElementById("score").textContent = "Score : " + score;
      document.getElementById("moves").textContent = "Coups : " + moves;

      firstPiece.classList.remove("selected");
      firstPiece = null;

      checkVictory();
    }

    function checkVictory() {
      if (puzzle.every((val, i) => val === i)) {
        clearInterval(interval);
        document.getElementById("winSound").play();
        document.getElementById("victoryMessage").classList.remove("hidden");
        document.getElementById("nextLevelBtn").disabled = false;
      }
    }

    function restartGame() {
      clearInterval(interval);
      document.getElementById("victoryMessage").classList.add("hidden");
      startGame();
    }

    function goToLevel2() {
      alert("Niveau 2 bientôt disponible !");
    }
  </script>
</body>
</html>
