<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Puzzle</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1><span class="emoji red">ðŸ§©</span> Puzzle : Niveau 1 <span class="emoji blue">ðŸ§©</span></h1>

    <div class="player-entry" id="playerEntry">
      <input type="text" id="playerName" placeholder="Entrez votre nom" />
      <button onclick="startGame()">Commencer</button>
    </div>

    <div class="game-info" id="gameInfo" style="display: none;">
      <div class="top-bar">
        <span id="playerLabel"></span>
        <span id="scoreLabel">Score : 0</span>
        <span id="movesLabel">Coups : 0</span>
      </div>

      <div class="puzzle-container" id="puzzleContainer"></div>

      <div class="bottom-bar">
        <button onclick="restartGame()">Rejouer</button>
        <span id="timer">ðŸ•’ 0:00</span>
        <button id="nextLevel" disabled onclick="nextLevel()">Niveau 2</button>
      </div>
    </div>

    <div class="victory-message" id="victoryMessage">ðŸŽ‰ Bravo ! Puzzle terminÃ© ðŸŽ‰</div>

    <img src="Files/PUB.png" alt="pub" class="pub" />
  </div>

  <audio id="clickSound" src="Files/click.mp3"></audio>
  <audio id="swapSound" src="Files/swap.mp3"></audio>
  <audio id="winSound" src="Files/win.mp3"></audio>

  <script>
    const puzzleSize = 3;
    let pieces = [], moves = 0, score = 0, timer = 0, interval;

    function startGame() {
      const name = document.getElementById("playerName").value.trim();
      if (!name) return alert("Veuillez entrer votre nom.");
      document.getElementById("playerLabel").textContent = "ðŸ‘¤ " + name;
      document.getElementById("playerEntry").style.display = "none";
      document.getElementById("gameInfo").style.display = "block";
      initPuzzle();
    }

    function initPuzzle() {
      const container = document.getElementById("puzzleContainer");
      container.innerHTML = "";
      document.getElementById("victoryMessage").style.display = "none";
      pieces = [];
      moves = 0;
      score = 0;
      updateLabels();
      document.getElementById("nextLevel").disabled = true;
      clearInterval(interval);
      timer = 0;
      interval = setInterval(() => {
        timer++;
        const min = Math.floor(timer / 60);
        const sec = timer % 60;
        document.getElementById("timer").textContent = `ðŸ•’ ${min}:${sec < 10 ? "0" + sec : sec}`;
      }, 1000);

      const positions = [];
      for (let i = 0; i < puzzleSize * puzzleSize; i++) positions.push(i);
      shuffle(positions);
      while (positions.some((v, i) => v === i)) shuffle(positions); // s'assurer que câ€™est mÃ©langÃ©

      for (let i = 0; i < puzzleSize * puzzleSize; i++) {
        const piece = document.createElement("div");
        piece.className = "puzzle-piece";
        const row = Math.floor(positions[i] / puzzleSize);
        const col = positions[i] % puzzleSize;
        piece.style.backgroundImage = "url('Files/cat.jpg')";
        piece.style.backgroundSize = `${puzzleSize * 100}% ${puzzleSize * 100}%`;
        piece.style.backgroundPosition = `${(col * 100) / (puzzleSize - 1)}% ${(row * 100) / (puzzleSize - 1)}%`;
        piece.dataset.correct = i;
        piece.dataset.current = positions[i];
        piece.addEventListener("click", () => selectPiece(piece));
        container.appendChild(piece);
        pieces.push(piece);
      }
    }

    let first = null;
    function selectPiece(piece) {
      document.getElementById("clickSound").play();
      if (!first) {
        first = piece;
        piece.classList.add("selected");
      } else if (first !== piece) {
        document.getElementById("swapSound").play();
        const temp = first.dataset.current;
        first.dataset.current = piece.dataset.current;
        piece.dataset.current = temp;

        const tempBG = first.style.backgroundPosition;
        first.style.backgroundPosition = piece.style.backgroundPosition;
        piece.style.backgroundPosition = tempBG;

        first.classList.remove("selected");
        moves++;
        if (first.dataset.correct == first.dataset.current && piece.dataset.correct == piece.dataset.current) {
          score += 2;
        } else {
          score = Math.max(0, score - 1);
        }
        updateLabels();
        first = null;

        if (pieces.every(p => p.dataset.correct === p.dataset.current)) {
          clearInterval(interval);
          document.getElementById("victoryMessage").style.display = "block";
          document.getElementById("winSound").play();
          document.getElementById("nextLevel").disabled = false;
        }
      }
    }

    function updateLabels() {
      document.getElementById("movesLabel").textContent = `Coups : ${moves}`;
      document.getElementById("scoreLabel").textContent = `Score : ${score}`;
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function restartGame() {
      initPuzzle();
    }

    function nextLevel() {
      alert("Le niveau 2 arrive bientÃ´t !");
    }
  </script>
</body>
</html>
