<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🧩 Puzzle : Niveau 1 🧠</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="game-container">
    <h1><span class="puzzle-icon red">🧩</span> Puzzle : Niveau 1 <span class="puzzle-icon blue">🧩</span></h1>

    <div id="name-section">
      <label for="playerName">Nom du joueur :</label>
      <input type="text" id="playerName" placeholder="Entrez votre nom" />
      <button onclick="startGame()">Commencer</button>
    </div>

    <div id="game-ui" style="display:none;">
      <div class="top-bar">
        <div id="score">Score : 0</div>
        <div id="timer">🕒 0:00</div>
        <div id="moves">Coups : 0</div>
      </div>

      <div id="puzzle-container"></div>

      <div class="bottom-bar">
        <button onclick="resetGame()">🔁 Rejouer</button>
        <div id="time-info">🕒 0:00</div>
        <button id="next-level" disabled onclick="nextLevel()">⏭️ Niveau 2</button>
      </div>

      <div id="victory" class="hidden">🎉 Bravo ! Puzzle terminé 🎉</div>
      <img id="pub" src="Files/PUB.png" alt="Publicité" />
    </div>
  </div>

  <audio id="click-sound" src="Files/click.mp3"></audio>
  <audio id="swap-sound" src="Files/swap.mp3"></audio>
  <audio id="win-sound" src="Files/win.mp3"></audio>

  <script>
    const puzzleContainer = document.getElementById("puzzle-container");
    const scoreDisplay = document.getElementById("score");
    const timerDisplay = document.getElementById("timer");
    const movesDisplay = document.getElementById("moves");
    const timeInfo = document.getElementById("time-info");
    const victoryMsg = document.getElementById("victory");
    const pubImage = document.getElementById("pub");
    const nextLevelBtn = document.getElementById("next-level");

    let playerName = "";
    let pieces = [];
    let size = 3;
    let firstPiece = null;
    let moves = 0;
    let score = 0;
    let timer = 0;
    let interval;

    function startGame() {
      playerName = document.getElementById("playerName").value.trim();
      if (!playerName) return alert("Veuillez entrer votre nom.");
      document.getElementById("name-section").style.display = "none";
      document.getElementById("game-ui").style.display = "block";
      initGame();
    }

    function initGame() {
      puzzleContainer.innerHTML = "";
      victoryMsg.classList.add("hidden");
      nextLevelBtn.disabled = true;
      moves = 0;
      score = 0;
      timer = 0;
      updateScore();
      updateMoves();
      updateTimer();
      clearInterval(interval);
      interval = setInterval(() => {
        timer++;
        updateTimer();
      }, 1000);
      generatePuzzle();
    }

    function updateScore() {
      scoreDisplay.textContent = `Score : ${score}`;
    }

    function updateMoves() {
      movesDisplay.textContent = `Coups : ${moves}`;
    }

    function updateTimer() {
      const minutes = Math.floor(timer / 60);
      const seconds = timer % 60;
      const formatted = `🕒 ${minutes}:${seconds.toString().padStart(2, '0')}`;
      timerDisplay.textContent = formatted;
      timeInfo.textContent = formatted;
    }

    function generatePuzzle() {
      const total = size * size;
      pieces = Array.from({ length: total }, (_, i) => i);
      do {
        pieces.sort(() => Math.random() - 0.5);
      } while (pieces.some((val, i) => val === i));
      pieces.forEach((val, index) => {
        const piece = document.createElement("div");
        piece.className = "piece";
        piece.style.backgroundImage = "url('Files/cat.jpg')";
        piece.style.backgroundSize = `${size * 100}%`;
        piece.style.backgroundPosition = `${(val % size) * 100}% ${(Math.floor(val / size)) * 100}%`;
        piece.dataset.index = index;
        piece.dataset.value = val;
        piece.addEventListener("click", () => onPieceClick(piece));
        puzzleContainer.appendChild(piece);
      });
    }

    function onPieceClick(piece) {
      document.getElementById("click-sound").play();
      if (firstPiece === piece) return;
      if (!firstPiece) {
        firstPiece = piece;
        piece.classList.add("selected");
        return;
      }

      swapPieces(firstPiece, piece);
      firstPiece.classList.remove("selected");
      firstPiece = null;
      moves++;
      updateMoves();
      checkWin();
    }

    function swapPieces(p1, p2) {
      const val1 = p1.dataset.value;
      const val2 = p2.dataset.value;
      [p1.dataset.value, p2.dataset.value] = [val2, val1];

      p1.style.backgroundPosition = `${(val2 % size) * 100}% ${(Math.floor(val2 / size)) * 100}%`;
      p2.style.backgroundPosition = `${(val1 % size) * 100}% ${(Math.floor(val1 / size)) * 100}%`;

      if (parseInt(p1.dataset.index) === parseInt(val2) || parseInt(p2.dataset.index) === parseInt(val1)) {
        score += 2;
      } else {
        score = Math.max(0, score - 1);
      }
      document.getElementById("swap-sound").play();
      updateScore();
    }

    function checkWin() {
      const isCorrect = Array.from(puzzleContainer.children).every((p, i) => parseInt(p.dataset.value) === i);
      if (isCorrect) {
        clearInterval(interval);
        document.getElementById("win-sound").play();
        victoryMsg.classList.remove("hidden");
        nextLevelBtn.disabled = false;
      }
    }

    function resetGame() {
      initGame();
    }

    function nextLevel() {
      alert("Niveau 2 à venir !");
    }
  </script>
</body>
</html>
