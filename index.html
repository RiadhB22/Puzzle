<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Puzzle Game</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1 class="title">üß© PUZZLE GAME</h1>

  <div id="player-form">
    <input type="text" id="player-name" placeholder="Entrez votre nom" />
    <button id="start-button">Commencer</button>
  </div>

  <div id="player-info"></div>
  <div id="stage-info"></div>
  <div id="puzzle-container"></div>
  <div id="score-panel">‚è± Temps : <span id="timer">0</span>s | Score : <span id="score">0</span></div>

  <button id="next-button">‚û° Niveau suivant</button>

  <div id="ad-space">
    <h3>Publicit√©</h3>
    <img src="Files/PUB.png" alt="Publicit√©" />
  </div>

  <script>
    let seconds = 0;
    let score = 0;
    let interval;
    const correctOrder = [...Array(9).keys()];
    let currentOrder = [];

    document.getElementById("start-button").addEventListener("click", () => {
      const name = document.getElementById("player-name").value.trim() || "Joueur";
      document.getElementById("player-form").style.display = "none";
      document.getElementById("player-info").textContent = `üë§ Joueur : ${name}`;
      document.getElementById("stage-info").textContent = `üìå Stage 1`;

      startTimer();
      createPuzzle();
    });

    function startTimer() {
      interval = setInterval(() => {
        seconds++;
        document.getElementById("timer").textContent = seconds;
      }, 1000);
    }

    function createPuzzle() {
      const container = document.getElementById("puzzle-container");
      container.innerHTML = "";
      currentOrder = [...correctOrder].sort(() => Math.random() - 0.5);

      currentOrder.forEach(i => {
        const tile = document.createElement("div");
        tile.classList.add("tile");
        const row = Math.floor(i / 3);
        const col = i % 3;
        tile.style.backgroundPosition = `-${col * 120}px -${row * 120}px`;
        tile.setAttribute("data-index", i);
        tile.addEventListener("click", handleTileClick);
        container.appendChild(tile);
      });
    }

    let firstTile = null;
    function handleTileClick(e) {
      const clickedTile = e.target;
      if (!firstTile) {
        firstTile = clickedTile;
        clickedTile.style.border = "2px solid green";
      } else {
        if (clickedTile === firstTile) {
          firstTile.style.border = "none";
          firstTile = null;
          return;
        }
        swapTiles(firstTile, clickedTile);
        firstTile.style.border = "none";
        firstTile = null;
        checkVictory();
      }
    }

    function swapTiles(tile1, tile2) {
      const tempPos = tile1.style.backgroundPosition;
      tile1.style.backgroundPosition = tile2.style.backgroundPosition;
      tile2.style.backgroundPosition = tempPos;

      score -= 1;
      document.getElementById("score").textContent = score;
    }

    function checkVictory() {
      const tiles = document.querySelectorAll(".tile");
      let won = true;
      tiles.forEach((tile, index) => {
        const expectedRow = Math.floor(index / 3);
        const expectedCol = index % 3;
        const expectedPos = `-${expectedCol * 120}px -${expectedRow * 120}px`;
        if (tile.style.backgroundPosition !== expectedPos) {
          won = false;
        }
      });
      if (won) {
        clearInterval(interval);
        document.getElementById("next-button").style.display = "inline-block";
        const container = document.getElementById("puzzle-container");
        container.style.transform = "scale(1.2)";
        setTimeout(() => {
          alert("Bravo ! Vous avez compl√©t√© le puzzle. Passons au stage 2.");
          container.style.transform = "scale(1.0)";
        }, 1000);
      }
    }
  </script>
</body>
</html>
