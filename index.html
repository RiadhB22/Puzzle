<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Puzzle Game</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1 class="title">Puzzle Game</h1>

  <div id="player-form">
    <input type="text" id="player-name" placeholder="Entrez votre nom">
    <button id="start-button">Commencer</button>
  </div>

  <div id="top-bar" style="display: none;">
    Joueur : <span id="player-display"></span> | Score : <span id="score">0</span>
  </div>

  <div id="puzzle-container"></div>

  <div id="controls" style="display: none;">
    <button id="replay-button">Rejouer</button>
    <span id="level-display">Niveau 1</span>
    <button id="level2-button" disabled>Niveau 2</button>
  </div>

  <div id="ad-space">
    <h3>Publicit√©</h3>
    <img src="Files/PUB.png" alt="PUB">
  </div>

  <script>
    const playerNameInput = document.getElementById("player-name");
    const startButton = document.getElementById("start-button");
    const topBar = document.getElementById("top-bar");
    const playerDisplay = document.getElementById("player-display");
    const puzzleContainer = document.getElementById("puzzle-container");
    const scoreDisplay = document.getElementById("score");
    const replayButton = document.getElementById("replay-button");
    const level2Button = document.getElementById("level2-button");
    const levelDisplay = document.getElementById("level-display");
    const controls = document.getElementById("controls");

    let score = 0;
    let playerName = "";
    let selected = null;
    let tiles = [];
    let level = 1;
    let gridSize = 3;
    let imageSrc = "Files/cat.jpg";

    startButton.addEventListener("click", () => {
      playerName = playerNameInput.value.trim();
      if (playerName) {
        playerDisplay.textContent = playerName;
        document.getElementById("player-form").style.display = "none";
        topBar.style.display = "block";
        controls.style.display = "block";
        startLevel(1);
      }
    });

    replayButton.addEventListener("click", () => {
      startLevel(level);
    });

    level2Button.addEventListener("click", () => {
      startLevel(2);
    });

    function startLevel(lv) {
      level = lv;
      score = 0;
      scoreDisplay.textContent = score;
      levelDisplay.textContent = `Niveau ${lv}`;
      level2Button.disabled = true;

      if (lv === 1) {
        gridSize = 3;
        imageSrc = "Files/cat.jpg";
      } else {
        gridSize = 4;
        imageSrc = "Files/cat2.jpg";
      }

      generatePuzzle();
    }

    function generatePuzzle() {
      puzzleContainer.innerHTML = "";
      puzzleContainer.style.gridTemplateColumns = `repeat(${gridSize}, 120px)`;
      puzzleContainer.style.gridTemplateRows = `repeat(${gridSize}, 120px)`;

      tiles = [];
      for (let row = 0; row < gridSize; row++) {
        for (let col = 0; col < gridSize; col++) {
          tiles.push({
            correctIndex: row * gridSize + col,
            currentIndex: row * gridSize + col,
            row,
            col
          });
        }
      }

      do {
        shuffleArray(tiles);
      } while (tiles.some((t, i) => t.correctIndex === i));

      tiles.forEach((tile, index) => {
        const div = document.createElement("div");
        div.classList.add("tile");
        const correctRow = Math.floor(tile.correctIndex / gridSize);
        const correctCol = tile.correctIndex % gridSize;
        div.style.backgroundImage = `url(${imageSrc})`;
        div.style.backgroundPosition = `-${correctCol * 120}px -${correctRow * 120}px`;
        div.dataset.index = index;
        puzzleContainer.appendChild(div);
      });

      document.querySelectorAll(".tile").forEach(tile => {
        tile.addEventListener("click", () => {
          if (!selected) {
            selected = tile;
            tile.classList.add("selected");
          } else {
            const index1 = parseInt(selected.dataset.index);
            const index2 = parseInt(tile.dataset.index);
            if (index1 !== index2) {
              [tiles[index1], tiles[index2]] = [tiles[index2], tiles[index1]];
              score += (tiles[index1].correctIndex === index1 && tiles[index2].correctIndex === index2) ? 5 : -1;
              scoreDisplay.textContent = score;
              generatePuzzle();
              if (checkCompletion()) {
                showCongrats();
                level2Button.disabled = false;
              }
            }
            selected.classList.remove("selected");
            selected = null;
          }
        });
      });
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function checkCompletion() {
      return tiles.every((tile, i) => tile.correctIndex === i);
    }

    function showCongrats() {
      const msg = document.createElement("div");
      msg.className = "congrats-message";
      msg.textContent = "üéâ Bravo ! Vous avez compl√©t√© le puzzle !";
      document.body.appendChild(msg);
      setTimeout(() => msg.remove(), 4000);
    }
  </script>
</body>
</html>
