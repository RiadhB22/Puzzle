<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Puzzle Game</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1 class="title">🧩 Puzzle Game</h1>

  <div id="player-form">
    <input type="text" id="player-name" placeholder="Entrez votre nom">
    <button id="start-button">Commencer</button>
  </div>

  <div id="top-bar">
    <span id="player-info"></span>
    <span id="score-panel"> | Score : <span id="score">0</span></span>
  </div>

  <div id="puzzle-container"></div>

  <div id="controls">
    <button id="replay-button">🔁 Rejouer</button>
    <span id="stage-info">Niveau 1</span>
    <button id="level2-button">➡️ Niveau 2</button>
  </div>

  <div id="ad-space">
    <h3>Publicité</h3>
    <img src="Files/PUB.png" alt="Publicité" style="width: 100%; max-width: 200px;">
  </div>

  <script>
    const playerNameInput = document.getElementById("player-name");
    const startButton = document.getElementById("start-button");
    const playerForm = document.getElementById("player-form");
    const playerInfo = document.getElementById("player-info");
    const puzzleContainer = document.getElementById("puzzle-container");
    const scoreSpan = document.getElementById("score");
    const replayButton = document.getElementById("replay-button");
    const level2Button = document.getElementById("level2-button");

    let dragged = null;
    let score = 0;

    function shuffleTiles() {
      const indexes = Array.from({length: 9}, (_, i) => i);
      indexes.sort(() => Math.random() - 0.5);
      return indexes;
    }

    function renderPuzzle() {
      puzzleContainer.innerHTML = "";
      const order = shuffleTiles();
      for (let i = 0; i < 9; i++) {
        const tile = document.createElement("div");
        tile.className = "tile";
        tile.style.backgroundImage = "url('Files/cat.jpg')";
        tile.style.backgroundSize = "360px 360px";
        tile.style.backgroundPosition = `-${(order[i] % 3) * 120}px -${Math.floor(order[i] / 3) * 120}px`;
        tile.dataset.correct = order[i];
        tile.draggable = true;
        tile.addEventListener("dragstart", dragStart);
        tile.addEventListener("dragover", dragOver);
        tile.addEventListener("drop", dropTile);
        puzzleContainer.appendChild(tile);
      }
    }

    function dragStart(e) {
      dragged = e.target;
    }

    function dragOver(e) {
      e.preventDefault();
    }

    function dropTile(e) {
      e.preventDefault();
      if (dragged && dragged !== e.target) {
        const draggedIndex = Array.from(puzzleContainer.children).indexOf(dragged);
        const targetIndex = Array.from(puzzleContainer.children).indexOf(e.target);
        const draggedCorrect = dragged.dataset.correct;
        const targetCorrect = e.target.dataset.correct;

        puzzleContainer.insertBefore(dragged, puzzleContainer.children[targetIndex]);
        puzzleContainer.insertBefore(e.target, puzzleContainer.children[draggedIndex]);

        if (parseInt(draggedCorrect) === targetIndex && parseInt(targetCorrect) === draggedIndex) {
          score += 5;
        } else {
          score -= 1;
        }
        scoreSpan.textContent = score;
        checkWin();
      }
    }

    function checkWin() {
      const tiles = puzzleContainer.children;
      let correct = true;
      for (let i = 0; i < tiles.length; i++) {
        const pos = parseInt(tiles[i].dataset.correct);
        if (pos !== i) correct = false;
      }
      if (correct) {
        puzzleContainer.style.transform = "scale(1.2)";
        clearInterval(timer);
        replayButton.style.display = "inline-block";
        level2Button.style.display = "inline-block";
      }
    }

    startButton.onclick = () => {
      const name = playerNameInput.value.trim();
      if (name) {
        playerInfo.textContent = `👤 ${name}`;
        playerForm.style.display = "none";
        renderPuzzle();
        score = 0;
        scoreSpan.textContent = score;
        startTimer();
      }
    };

    replayButton.onclick = () => {
      puzzleContainer.style.transform = "scale(1)";
      renderPuzzle();
      score = 0;
      scoreSpan.textContent = score;
      startTimer();
    };

    level2Button.onclick = () => {
      alert("Passage au niveau 2 bientôt disponible...");
    };

    let timer;
    function startTimer() {
      clearInterval(timer);
      timer = setInterval(() => {}, 1000);
    }
  </script>
</body>
</html>
