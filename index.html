<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üß© Puzzle : Niveau 1 üß†</title>
  <link rel="stylesheet" href="Puzzle/style.css" />
</head>
<body>
  <div class="container">
    <h1><span class="emoji red">üß©</span> Puzzle : Niveau 1 <span class="emoji blue">üß©</span></h1>

    <div id="player-input">
      <input type="text" id="playerName" placeholder="Entrez votre nom..." />
      <button onclick="startGame()">Commencer</button>
    </div>

    <div id="game-area" class="hidden">
      <div class="top-info">
        <span id="playerDisplay"></span>
        <span id="score">Score : 0</span>
        <span id="moves">Coups : 0</span>
      </div>

      <div class="controls">
        <button onclick="restartGame()">üîÅ Rejouer</button>
        <span id="timer">üïí 0:00</span>
        <button id="nextLevelBtn" onclick="nextLevel()" disabled>‚û°Ô∏è Niveau 2</button>
      </div>

      <div id="puzzle"></div>
      <img src="Puzzle/Files/PUB.png" class="pub-image" />
    </div>
  </div>

  <audio id="clickSound" src="Puzzle/Files/click.mp3"></audio>
  <audio id="swapSound" src="Puzzle/Files/swap.mp3"></audio>
  <audio id="winSound" src="Puzzle/Files/win.mp3"></audio>

  <script>
    const puzzle = document.getElementById("puzzle");
    const scoreEl = document.getElementById("score");
    const movesEl = document.getElementById("moves");
    const timerEl = document.getElementById("timer");
    const playerDisplay = document.getElementById("playerDisplay");
    const nextLevelBtn = document.getElementById("nextLevelBtn");
    const clickSound = document.getElementById("clickSound");
    const swapSound = document.getElementById("swapSound");
    const winSound = document.getElementById("winSound");

    let gridSize = 3;
    let pieces = [];
    let firstPiece = null;
    let moves = 0;
    let score = 0;
    let timer;
    let time = 0;

    function startGame() {
      const name = document.getElementById("playerName").value.trim();
      if (!name) return alert("Entrez votre nom");
      document.getElementById("player-input").classList.add("hidden");
      document.getElementById("game-area").classList.remove("hidden");
      playerDisplay.textContent = "üë§ " + name;
      initPuzzle();
      startTimer();
    }

    function initPuzzle() {
      puzzle.innerHTML = "";
      pieces = [];
      for (let i = 0; i < gridSize * gridSize; i++) {
        const piece = document.createElement("div");
        piece.className = "piece";
        piece.style.backgroundImage = "url('Puzzle/Files/cat.jpg')";
        piece.dataset.index = i;
        pieces.push(piece);
      }

      do {
        shuffleArray(pieces);
      } while (pieces.some((p, i) => i == p.dataset.index));

      pieces.forEach((piece, index) => {
        piece.style.order = index;
        piece.style.backgroundPosition = `${-(piece.dataset.index % gridSize) * 100 / (gridSize - 1)}% ${-Math.floor(piece.dataset.index / gridSize) * 100 / (gridSize - 1)}%`;
        piece.addEventListener("click", () => handleClick(piece));
        puzzle.appendChild(piece);
      });

      moves = 0;
      score = 0;
      updateScore();
    }

    function handleClick(piece) {
      clickSound.play();
      if (!firstPiece) {
        firstPiece = piece;
        piece.classList.add("selected");
      } else if (firstPiece === piece) {
        firstPiece.classList.remove("selected");
        firstPiece = null;
      } else {
        swapSound.play();
        const index1 = Array.from(puzzle.children).indexOf(firstPiece);
        const index2 = Array.from(puzzle.children).indexOf(piece);
        puzzle.insertBefore(firstPiece, puzzle.children[index2]);
        puzzle.insertBefore(piece, puzzle.children[index1]);
        firstPiece.classList.remove("selected");
        firstPiece = null;
        moves++;
        checkWin();
      }
      updateScore();
    }

    function updateScore() {
      scoreEl.textContent = `Score : ${score}`;
      movesEl.textContent = `Coups : ${moves}`;
    }

    function checkWin() {
      const correct = Array.from(puzzle.children).every((piece, index) => piece.dataset.index == index);
      if (correct) {
        winSound.play();
        nextLevelBtn.disabled = false;
        clearInterval(timer);
        setTimeout(() => {
          alert("üéâ Bravo ! Puzzle termin√© !");
        }, 300);
      } else {
        score += 1;
      }
    }

    function restartGame() {
      clearInterval(timer);
      time = 0;
      timerEl.textContent = "üïí 0:00";
      nextLevelBtn.disabled = true;
      initPuzzle();
      startTimer();
    }

    function startTimer() {
      timer = setInterval(() => {
        time++;
        const minutes = Math.floor(time / 60);
        const seconds = time % 60;
        timerEl.textContent = `üïí ${minutes}:${seconds.toString().padStart(2, "0")}`;
      }, 1000);
    }

    function nextLevel() {
      alert("üîú Chargement du niveau 2...");
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
  </script>
</body>
</html>
