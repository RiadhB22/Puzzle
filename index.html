<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸ§© Puzzle : Niveau 1 ðŸ§ </title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1><span class="emoji1">ðŸ§©</span> Puzzle : Niveau 1 <span class="emoji2">ðŸ§ </span></h1>

    <div class="player-input">
      <input type="text" id="playerName" placeholder="Entrez votre nom" />
      <button id="startBtn">Commencer</button>
    </div>

    <div id="gameUI" class="hidden">
      <div class="top-bar">
        <div id="score">Score : 0</div>
        <div id="moves">Coups : 0</div>
        <div id="timer">ðŸ•’ 0:00</div>
      </div>

      <div id="puzzle-container"></div>

      <div class="buttons">
        <button onclick="restartGame()">Rejouer</button>
        <div id="timerCenter">ðŸ•’ 0:00</div>
        <button id="nextLevelBtn" disabled>Niveau 2</button>
      </div>

      <img src="Files/PUB.png" class="pub" alt="PublicitÃ©" />
    </div>
  </div>

  <script>
    const puzzleSize = 3;
    const puzzleContainer = document.getElementById("puzzle-container");
    const startBtn = document.getElementById("startBtn");
    const playerNameInput = document.getElementById("playerName");
    const gameUI = document.getElementById("gameUI");
    const scoreEl = document.getElementById("score");
    const movesEl = document.getElementById("moves");
    const timerEl = document.getElementById("timer");
    const timerCenter = document.getElementById("timerCenter");
    const nextLevelBtn = document.getElementById("nextLevelBtn");

    let pieces = [];
    let moveCount = 0;
    let score = 0;
    let firstPiece = null;
    let timerInterval;
    let startTime;

    const clickSound = new Audio("Files/click.mp3");
    const swapSound = new Audio("Files/swap.mp3");
    const winSound = new Audio("Files/win.mp3");

    startBtn.addEventListener("click", () => {
      if (playerNameInput.value.trim() === "") return;
      document.querySelector(".player-input").classList.add("hidden");
      gameUI.classList.remove("hidden");
      startGame();
    });

    function startGame() {
      generatePuzzle();
      moveCount = 0;
      score = 0;
      scoreEl.textContent = "Score : 0";
      movesEl.textContent = "Coups : 0";
      nextLevelBtn.disabled = true;
      startTimer();
    }

    function startTimer() {
      clearInterval(timerInterval);
      startTime = Date.now();
      timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const min = Math.floor(elapsed / 60);
        const sec = elapsed % 60;
        timerEl.textContent = `ðŸ•’ ${min}:${sec.toString().padStart(2, '0')}`;
        timerCenter.textContent = timerEl.textContent;
      }, 1000);
    }

    function generatePuzzle() {
      puzzleContainer.innerHTML = "";
      pieces = [];

      for (let i = 0; i < puzzleSize * puzzleSize; i++) {
        pieces.push(i);
      }

      do {
        pieces = pieces.sort(() => Math.random() - 0.5);
      } while (pieces.some((val, idx) => val === idx));

      pieces.forEach((num, index) => {
        const piece = document.createElement("div");
        piece.className = "piece";
        piece.style.backgroundImage = "url('Files/cat.jpg')";
        piece.dataset.index = index;
        piece.dataset.correct = num;
        positionPiece(piece, num);
        piece.addEventListener("click", () => handleClick(piece));
        puzzleContainer.appendChild(piece);
      });
    }

    function positionPiece(piece, num) {
      const size = 100 / puzzleSize;
      const row = Math.floor(num / puzzleSize);
      const col = num % puzzleSize;
      piece.style.backgroundSize = `${puzzleSize * 100}% ${puzzleSize * 100}%`;
      piece.style.backgroundPosition = `${(col * 100) / (puzzleSize - 1)}% ${(row * 100) / (puzzleSize - 1)}%`;
    }

    function handleClick(piece) {
      clickSound.play();
      if (!firstPiece) {
        firstPiece = piece;
        piece.classList.add("selected");
        return;
      }

      if (firstPiece === piece) {
        firstPiece.classList.remove("selected");
        firstPiece = null;
        return;
      }

      swapPieces(firstPiece, piece);
      firstPiece.classList.remove("selected");
      firstPiece = null;
    }

    function swapPieces(p1, p2) {
      swapSound.play();
      const tempCorrect = p1.dataset.correct;
      p1.dataset.correct = p2.dataset.correct;
      p2.dataset.correct = tempCorrect;

      positionPiece(p1, p1.dataset.correct);
      positionPiece(p2, p2.dataset.correct);

      moveCount++;
      movesEl.textContent = `Coups : ${moveCount}`;

      if (p1.dataset.correct == p1.dataset.index && p2.dataset.correct == p2.dataset.index) {
        score += 2;
      } else {
        score -= 1;
      }
      scoreEl.textContent = `Score : ${score}`;

      checkWin();
    }

    function checkWin() {
      const allCorrect = [...puzzleContainer.children].every(
        piece => piece.dataset.correct == piece.dataset.index
      );
      if (allCorrect) {
        winSound.play();
        clearInterval(timerInterval);
        alert("ðŸŽ‰ FÃ©licitations !");
        nextLevelBtn.disabled = false;
      }
    }

    function restartGame() {
      startGame();
    }
  </script>
</body>
</html>
