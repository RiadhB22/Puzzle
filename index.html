<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Puzzle Game</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1 class="title">üß© Puzzle Game</h1>

  <div id="player-form">
    <input type="text" id="player-name" placeholder="Entrez votre nom">
    <button id="start-button">Commencer</button>
  </div>

  <div id="player-info"></div>
  <div id="stage-info">Niveau 1</div>
  <div id="score-panel">Score : <span id="score">0</span></div>

  <div id="puzzle-container"></div>

  <div>
    <button id="replay-button">üîÅ Rejouer</button>
    <button id="level2-button">‚û°Ô∏è Niveau 2</button>
  </div>

  <div id="ad-space">
    <h3>Publicit√©</h3>
    <img src="Files/PUB.png" alt="Publicit√©">
  </div>

  <script>
    const playerNameInput = document.getElementById("player-name");
    const startButton = document.getElementById("start-button");
    const playerInfo = document.getElementById("player-info");
    const puzzleContainer = document.getElementById("puzzle-container");
    const scoreSpan = document.getElementById("score");
    const replayButton = document.getElementById("replay-button");
    const level2Button = document.getElementById("level2-button");

    let tiles = [];
    let score = 0;

    function shuffleTiles() {
      const indexes = Array.from({length: 9}, (_, i) => i);
      indexes.sort(() => Math.random() - 0.5);
      return indexes;
    }

    function renderPuzzle() {
      puzzleContainer.innerHTML = "";
      const order = shuffleTiles();
      for (let i = 0; i < 9; i++) {
        const tile = document.createElement("div");
        tile.className = "tile";
        tile.style.backgroundPosition = `-${(order[i] % 3) * 120}px -${Math.floor(order[i] / 3) * 120}px`;
        tile.dataset.order = order[i];
        tile.draggable = true;
        tile.addEventListener("dragstart", dragStart);
        tile.addEventListener("dragover", dragOver);
        tile.addEventListener("drop", dropTile);
        puzzleContainer.appendChild(tile);
      }
    }

    let dragged = null;

    function dragStart(e) {
      dragged = e.target;
    }

    function dragOver(e) {
      e.preventDefault();
    }

    function dropTile(e) {
      e.preventDefault();
      if (dragged && dragged !== e.target) {
        let tmp = document.createElement("div");
        puzzleContainer.insertBefore(tmp, dragged);
        puzzleContainer.insertBefore(dragged, e.target);
        puzzleContainer.insertBefore(e.target, tmp);
        puzzleContainer.removeChild(tmp);
        checkWin();
      }
    }

    function checkWin() {
      const tiles = puzzleContainer.children;
      let correct = true;
      for (let i = 0; i < tiles.length; i++) {
        const pos = parseInt(tiles[i].dataset.order);
        if (pos !== i) correct = false;
      }
      if (correct) {
        puzzleContainer.style.transform = "scale(1.2)";
        clearInterval(timer);
        replayButton.style.display = "inline-block";
        level2Button.style.display = "inline-block";
      }
    }

    startButton.onclick = () => {
      const name = playerNameInput.value.trim();
      if (name) {
        playerInfo.textContent = `üë§ ${name}`;
        renderPuzzle();
        score = 0;
        scoreSpan.textContent = score;
        startTimer();
      }
    };

    replayButton.onclick = () => {
      puzzleContainer.style.transform = "scale(1)";
      replayButton.style.display = "none";
      level2Button.style.display = "none";
      renderPuzzle();
      startTimer();
    };

    level2Button.onclick = () => {
      alert("Passage au niveau 2 bient√¥t disponible...");
    };

    let timer;
    function startTimer() {
      clearInterval(timer);
      timer = setInterval(() => {
        score++;
        scoreSpan.textContent = score;
      }, 1000);
    }
  </script>
</body>
</html>
