<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🧩 Puzzle : Niveau 1 🧠</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <header>
    <h1><span class="emoji1">🧩</span> Puzzle : Niveau 1 <span class="emoji2">🧠</span></h1>
  </header>

  <div id="startScreen">
    <label for="playerName">Entrez votre nom :</label>
    <input type="text" id="playerName" placeholder="Votre nom" />
    <button id="startBtn">Commencer</button>
  </div>

  <div id="gameArea" style="display: none;">
    <div id="infos">
      <span id="player">👤 </span>
      <span id="score">Score : 0</span>
    </div>

    <div id="puzzleContainer"></div>

    <div class="buttons">
      <button id="replayBtn">🔁 Rejouer</button>
      <span id="timer">🕒 0:00</span>
      <button id="nextBtn" disabled>➡️ Niveau 2</button>
    </div>

    <div id="winMessage">🎉 Bravo !</div>
    <img src="Files/PUB.png" alt="PUB" class="pub" />
  </div>

  <audio id="clickSound" src="Files/click.mp3"></audio>
  <audio id="swapSound" src="Files/swap.mp3"></audio>
  <audio id="winSound" src="Files/win.mp3"></audio>

  <script>
    const puzzleContainer = document.getElementById("puzzleContainer");
    const startBtn = document.getElementById("startBtn");
    const replayBtn = document.getElementById("replayBtn");
    const nextBtn = document.getElementById("nextBtn");
    const timerDisplay = document.getElementById("timer");
    const winMessage = document.getElementById("winMessage");
    const playerSpan = document.getElementById("player");
    const scoreDisplay = document.getElementById("score");

    let playerName = "";
    let score = 0;
    let timer = 0;
    let interval;
    let pieces = [];
    let size = 3;
    let selected = null;

    function initPuzzle() {
      puzzleContainer.innerHTML = "";
      pieces = [];

      for (let i = 0; i < size * size; i++) {
        pieces.push(i);
      }

      do {
        shuffleArray(pieces);
      } while (pieces.some((val, idx) => val === idx));

      pieces.forEach((num, i) => {
        const piece = document.createElement("div");
        piece.className = "piece";
        piece.style.backgroundImage = "url('Files/cat.jpg')";
        piece.style.backgroundSize = `${size * 100}%`;
        piece.style.backgroundPosition = `${(num % size) * 100}% ${(Math.floor(num / size)) * 100}%`;
        piece.dataset.index = i;
        piece.dataset.correct = num;
        piece.addEventListener("click", () => handleClick(piece));
        puzzleContainer.appendChild(piece);
      });

      updateScore(0);
      clearInterval(interval);
      timer = 0;
      updateTimer();
      interval = setInterval(() => {
        timer++;
        updateTimer();
      }, 1000);

      winMessage.style.display = "none";
      nextBtn.disabled = true;
    }

    function handleClick(piece) {
      document.getElementById("clickSound").play();
      if (!selected) {
        selected = piece;
        piece.classList.add("selected");
      } else if (piece !== selected) {
        swapPieces(piece, selected);
        piece.classList.remove("selected");
        selected.classList.remove("selected");
        selected = null;
      }
    }

    function swapPieces(p1, p2) {
      const i1 = p1.dataset.index;
      const i2 = p2.dataset.index;
      const temp = p1.dataset.correct;
      p1.dataset.correct = p2.dataset.correct;
      p2.dataset.correct = temp;

      p1.style.backgroundPosition = `${(p1.dataset.correct % size) * 100}% ${(Math.floor(p1.dataset.correct / size)) * 100}%`;
      p2.style.backgroundPosition = `${(p2.dataset.correct % size) * 100}% ${(Math.floor(p2.dataset.correct / size)) * 100}%`;

      document.getElementById("swapSound").play();

      if (p1.dataset.correct == i1 && p2.dataset.correct == i2) {
        updateScore(score + 2);
      } else {
        updateScore(score - 1);
      }

      checkWin();
    }

    function checkWin() {
      const pieces = document.querySelectorAll(".piece");
      const correct = [...pieces].every(piece => piece.dataset.index == piece.dataset.correct);
      if (correct) {
        clearInterval(interval);
        winMessage.style.display = "block";
        document.getElementById("winSound").play();
        nextBtn.disabled = false;
      }
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function updateTimer() {
      const min = Math.floor(timer / 60);
      const sec = timer % 60;
      timerDisplay.textContent = `🕒 ${min}:${sec.toString().padStart(2, "0")}`;
    }

    function updateScore(val) {
      score = val;
      scoreDisplay.textContent = `Score : ${score}`;
    }

    startBtn.addEventListener("click", () => {
      playerName = document.getElementById("playerName").value || "👤 Joueur";
      playerSpan.textContent = `👤 ${playerName}`;
      document.getElementById("startScreen").style.display = "none";
      document.getElementById("gameArea").style.display = "block";
      initPuzzle();
    });

    replayBtn.addEventListener("click", () => {
      initPuzzle();
    });

  </script>
</body>
</html>
