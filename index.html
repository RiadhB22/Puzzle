<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ§© Puzzle : Niveau 1 ğŸ§ </title>
  <link rel="stylesheet" href="Puzzle/style.css" />
</head>
<body>
  <div class="container">
    <h1><span class="puzzle-icon">ğŸ§©</span> Puzzle : Niveau 1 <span class="brain-icon">ğŸ§ </span></h1>

    <div id="start-screen">
      <input type="text" id="player-name" placeholder="Entrez votre nom..." />
      <button onclick="startGame()">Commencer</button>
    </div>

    <div id="game-info" style="display:none;">
      <div class="top-bar">
        <span id="player-display">Joueur : </span>
        <span id="score">Score : 0</span>
        <button onclick="restartGame()">ğŸ” Rejouer</button>
        <span id="timer">ğŸ•’ 0:00</span>
        <button id="next-btn" onclick="nextLevel()" disabled>â¡ï¸ Niveau 2</button>
      </div>

      <div id="puzzle-container"></div>
      <div id="message" class="hidden">ğŸ‰ Bravo ! Puzzle terminÃ© ! ğŸ‰</div>
      <img src="Puzzle/Files/PUB.png" alt="PublicitÃ©" id="pub" />
    </div>
  </div>

  <audio id="click-sound" src="Puzzle/Files/click.mp3"></audio>
  <audio id="swap-sound" src="Puzzle/Files/swap.mp3"></audio>
  <audio id="win-sound" src="Puzzle/Files/win.mp3"></audio>

  <script>
    const PUZZLE_SIZE = 3;
    const puzzleContainer = document.getElementById("puzzle-container");
    const message = document.getElementById("message");
    const clickSound = document.getElementById("click-sound");
    const swapSound = document.getElementById("swap-sound");
    const winSound = document.getElementById("win-sound");
    const playerDisplay = document.getElementById("player-display");
    const scoreDisplay = document.getElementById("score");
    const timerDisplay = document.getElementById("timer");
    const nextBtn = document.getElementById("next-btn");
    const pub = document.getElementById("pub");

    let pieces = [], empty = 0, score = 0, clicks = 0, startTime, timerInterval, playerName;
    let first = null;

    function startGame() {
      playerName = document.getElementById("player-name").value || "Joueur";
      document.getElementById("start-screen").style.display = "none";
      document.getElementById("game-info").style.display = "block";
      playerDisplay.textContent = "Joueur : " + playerName;
      score = 0;
      updateScore();
      createPuzzle();
      startTimer();
    }

    function createPuzzle() {
      puzzleContainer.innerHTML = "";
      pieces = [];
      for (let i = 0; i < PUZZLE_SIZE * PUZZLE_SIZE; i++) pieces.push(i);
      do {
        pieces.sort(() => Math.random() - 0.5);
      } while (pieces.some((v, i) => v === i));

      pieces.forEach((num, index) => {
        const div = document.createElement("div");
        div.className = "piece";
        div.style.backgroundImage = "url('Puzzle/Files/cat.jpg')";
        div.style.backgroundSize = `${PUZZLE_SIZE * 100}% ${PUZZLE_SIZE * 100}%`;
        div.style.backgroundPosition = `${(num % PUZZLE_SIZE) * -100}% ${(Math.floor(num / PUZZLE_SIZE)) * -100}%`;
        div.dataset.index = index;
        div.dataset.correct = num;
        div.addEventListener("click", () => handleClick(div));
        puzzleContainer.appendChild(div);
      });
    }

    function handleClick(tile) {
      clickSound.play();
      if (first === null) {
        first = tile;
        tile.classList.add("selected");
      } else {
        if (tile === first) return;
        swapPieces(first, tile);
        first.classList.remove("selected");
        first = null;
        checkWin();
      }
    }

    function swapPieces(a, b) {
      const ai = a.dataset.index;
      const bi = b.dataset.index;

      const temp = a.style.backgroundPosition;
      a.style.backgroundPosition = b.style.backgroundPosition;
      b.style.backgroundPosition = temp;

      [a.dataset.correct, b.dataset.correct] = [b.dataset.correct, a.dataset.correct];

      if (a.dataset.correct == a.dataset.index && b.dataset.correct == b.dataset.index) {
        score += 2;
      } else {
        score -= 1;
      }
      updateScore();
      swapSound.play();
    }

    function updateScore() {
      scoreDisplay.textContent = "Score : " + score;
    }

    function checkWin() {
      const pieces = document.querySelectorAll(".piece");
      const isWin = Array.from(pieces).every(p => p.dataset.index === p.dataset.correct);
      if (isWin) {
        winSound.play();
        message.classList.remove("hidden");
        nextBtn.disabled = false;
        clearInterval(timerInterval);
      }
    }

    function restartGame() {
      message.classList.add("hidden");
      nextBtn.disabled = true;
      first = null;
      score = 0;
      updateScore();
      createPuzzle();
      clearInterval(timerInterval);
      startTimer();
    }

    function startTimer() {
      startTime = Date.now();
      timerInterval = setInterval(() => {
        const t = Math.floor((Date.now() - startTime) / 1000);
        timerDisplay.textContent = `ğŸ•’ ${Math.floor(t / 60)}:${(t % 60).toString().padStart(2, "0")}`;
      }, 1000);
    }

    function nextLevel() {
      alert("Niveau 2 Ã  venir !");
    }
  </script>
</body>
</html>
