<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Puzzle Game2</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1 class="title">Puzzle Game2</h1>

  <div id="player-form">
    <input type="text" id="player-name" placeholder="Entrez votre nom">
    <button id="start-button">Commencer</button>
  </div>

  <div id="top-bar" style="display: none;">
    Joueur : <span id="player-display"></span> | Score : <span id="score">0</span>
  </div>

  <div id="puzzle-container"></div>

  <div id="controls" style="display: none;">
    <button id="replay-button">Rejouer</button>
    <span id="level-display">Niveau 1</span>
    <button id="level2-button" disabled>Niveau 2</button>
  </div>

  <div id="ad-space">
    <h3>Publicit√©</h3>
    <img src="Files/PUB.png" alt="PUB">
  </div>

  <script>
    const playerNameInput = document.getElementById("player-name");
    const startButton = document.getElementById("start-button");
    const topBar = document.getElementById("top-bar");
    const playerDisplay = document.getElementById("player-display");
    const puzzleContainer = document.getElementById("puzzle-container");
    const scoreDisplay = document.getElementById("score");
    const replayButton = document.getElementById("replay-button");
    const level2Button = document.getElementById("level2-button");
    const levelDisplay = document.getElementById("level-display");
    const controls = document.getElementById("controls");

    let score = 0;
    let playerName = "";
    let selected = null;
    let tiles = [];
    let level = 1;
    let gridSize = 3;
    let imageSrc = "Files/cat.jpg";

    startButton.addEventListener("click", () => {
      playerName = playerNameInput.value.trim();
      if (playerName) {
        playerDisplay.textContent = playerName;
        document.getElementById("player-form").style.display = "none";
        topBar.style.display = "block";
        controls.style.display = "flex";
        startLevel(1);
      }
    });

    replayButton.addEventListener("click", () => {
      startLevel(level);
    });

    level2Button.addEventListener("click", () => {
      startLevel(2);
    });

    function startLevel(lv) {
      level = lv;
      score = 0;
      scoreDisplay.textContent = score;
      levelDisplay.textContent = `Niveau ${lv}`;
      level2Button.disabled = true;

      if (lv === 1) {
        gridSize = 3;
        imageSrc = "Files/cat.jpg";
      } else {
        gridSize = 4;
        imageSrc = "Files/cat2.jpg";
      }

      generatePuzzle();
    }

    function generatePuzzle() {
      puzzleContainer.innerHTML = "";
      puzzleContainer.style.gridTemplateColumns = `repeat(${gridSize}, 120px)`;
      puzzleContainer.style.gridTemplateRows = `repeat(${gridSize}, 120px)`;

      tiles = [];
      for (let i = 0; i < gridSize * gridSize; i++) {
        const row = Math.floor(i / gridSize);
        const col = i % gridSize;
        tiles.push({ id: i, correctIndex: i, currentIndex: i, row, col });
      }

      do {
        shuffleArray(tiles);
      } while (tiles.some((tile, i) => tile.id === i));

      tiles.forEach((tile, i) => {
        tile.currentIndex = i;
        const div = document.createElement("div");
        div.classList.add("tile");
        const correctRow = Math.floor(tile.id / gridSize);
        const correctCol = tile.id % gridSize;
        div.style.backgroundImage = `url(${imageSrc})`;
        div.style.backgroundPosition = `-${correctCol * 120}px -${correctRow * 120}px`;
        div.dataset.id = tile.id;
        div.dataset.currentIndex = i;
        puzzleContainer.appendChild(div);
        tile.element = div;
      });

      document.querySelectorAll(".tile").forEach(tile => {
        tile.addEventListener("click", () => handleTileClick(tile));
      });
    }

    function handleTileClick(tileElement) {
      if (!selected) {
        selected = tileElement;
        tileElement.classList.add("selected");
        return;
      }

      if (selected === tileElement) {
        selected.classList.remove("selected");
        selected = null;
        return;
      }

      const id1 = parseInt(selected.dataset.id);
      const id2 = parseInt(tileElement.dataset.id);
      const index1 = tiles.findIndex(t => t.id === id1);
      const index2 = tiles.findIndex(t => t.id === id2);

      [tiles[index1], tiles[index2]] = [tiles[index2], tiles[index1]];

      score += (tiles[index1].id === index1 && tiles[index2].id === index2) ? 5 : -1;
      scoreDisplay.textContent = score;

      selected.classList.remove("selected");
      selected = null;

      updateTiles();

      if (checkCompletion()) {
        showCongrats();
        level2Button.disabled = false;
      }
    }

    function updateTiles() {
      puzzleContainer.innerHTML = "";
      tiles.forEach((tile, i) => {
        tile.currentIndex = i;
        const div = document.createElement("div");
        div.classList.add("tile");
        const correctRow = Math.floor(tile.id / gridSize);
        const correctCol = tile.id % gridSize;
        div.style.backgroundImage = `url(${imageSrc})`;
        div.style.backgroundPosition = `-${correctCol * 120}px -${correctRow * 120}px`;
        div.dataset.id = tile.id;
        div.dataset.currentIndex = i;
        puzzleContainer.appendChild(div);
        tile.element = div;
        div.addEventListener("click", () => handleTileClick(div));
      });
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function checkCompletion() {
      return tiles.every((tile, i) => tile.id === i);
    }

    function showCongrats() {
      const msg = document.createElement("div");
      msg.className = "congrats-message";
      msg.textContent = "üéâ Bravo ! Vous avez compl√©t√© le puzzle !";
      document.body.appendChild(msg);
      setTimeout(() => msg.remove(), 4000);
    }
  </script>
</body>
</html>
